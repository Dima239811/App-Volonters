<app-navbar></app-navbar>

<div class="admin-events">
  <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</h2>
  <form [formGroup]="eventForm" (ngSubmit)="submitEvent()">
    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è -->
    <div>
      <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è:</label>
      <input id="title" formControlName="title" required>
      <div *ngIf="title?.invalid && (title?.dirty || title?.touched)" class="error-message">
        <div *ngIf="title?.errors?.['required']">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</div>
        <div *ngIf="title?.errors?.['minlength']">
          –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ - {{title?.errors?.['minlength'].requiredLength}} —Å–∏–º–≤–æ–ª–æ–≤
        </div>
      </div>
    </div>

    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
    <div>
      <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
      <textarea id="description" formControlName="description" required></textarea>
      <div *ngIf="description?.invalid && (description?.dirty || description?.touched)" class="error-message">
        <div *ngIf="description?.errors?.['required']">–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</div>
        <div *ngIf="description?.errors?.['minlength']">
          –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ - {{description?.errors?.['minlength'].requiredLength}} —Å–∏–º–≤–æ–ª–æ–≤
        </div>
      </div>
    </div>

    <!-- –î–∞—Ç–∞ -->
    <div>
      <label for="date">–î–∞—Ç–∞:</label>
      <input id="date" type="date" [min]="minDate" formControlName="date" required>
      <div *ngIf="date?.invalid && (date?.dirty || date?.touched)" class="error-message">
        <div *ngIf="date?.errors?.['required']">–î–∞—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞</div>
        <div *ngIf="date?.errors?.['pastDate']">–ù–µ–ª—å–∑—è –≤—ã–±–∏—Ä–∞—Ç—å –ø—Ä–æ—à–µ–¥—à—É—é –¥–∞—Ç—É</div>
      </div>
    </div>

    <!-- –í—Ä–µ–º—è -->
    <div>
      <label for="time">–í—Ä–µ–º—è:</label>
      <input id="time" type="time" formControlName="time" required>
      <div *ngIf="time?.invalid && (time?.dirty || time?.touched)" class="error-message">
        <div *ngIf="time?.errors?.['required']">–í—Ä–µ–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</div>
        <div *ngIf="time?.errors?.['invalidTime']">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:MM</div>
      </div>
    </div>

    <!-- –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è -->
    <div>
      <label for="location">–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</label>
      <input id="location" formControlName="location" required>
      <div *ngIf="location?.invalid && (location?.dirty || location?.touched)" class="error-message">
        <div *ngIf="location?.errors?.['required']">–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</div>
        <div *ngIf="location?.errors?.['minlength']">
          –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ - {{location?.errors?.['minlength'].requiredLength}} —Å–∏–º–≤–æ–ª–æ–≤
        </div>
      </div>
    </div>

    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
    <div>
      <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
      <input id="category" formControlName="category" required>
      <div *ngIf="category?.invalid && (category?.dirty || category?.touched)" class="error-message">
        <div *ngIf="category?.errors?.['required']">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞</div>
      </div>
    </div>

    <!-- –°—Ä–æ—á–Ω–æ? -->
    <div>
      <label for="isUrgent">–°—Ä–æ—á–Ω–æ?</label>
      <select id="isUrgent" formControlName="isUrgent">
        <option value="–Ω–µ—Ç">–ù–µ—Ç</option>
        <option value="–¥–∞">–î–∞</option>
      </select>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å -->
    <!-- <div>
      <label for="status">–°—Ç–∞—Ç—É—Å:</label>
      <select id="status" formControlName="status">
        <option value="–∞–∫—Ç–∏–≤–Ω–æ">–ê–∫—Ç–∏–≤–Ω–æ</option>
        <option value="–∑–∞–≤–µ—Ä—à–µ–Ω–æ">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</option>
      </select>
    </div> -->

<!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
  <div class="file-upload">
  <label class="file-upload__label">
    <span class="file-upload__text">
      {{ selectedFile ? '–ò–∑–º–µ–Ω–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' : '–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }}
    </span>
    <input type="file" 
           (change)="onFileSelected($event)" 
           [disabled]="uploadInProgress"
           class="file-upload__input"
           accept="image/*">
    <span class="file-upload__icon">üìÅ</span>
  </label>
  
  <div *ngIf="selectedFile" class="file-upload__info">
    <div class="file-upload__name">
      <span class="file-upload__name-text">{{ selectedFile.name }}</span>
      <span class="file-upload__size">({{ getFileSize(selectedFile.size) }})</span>
    </div>
    
    <div *ngIf="uploadInProgress" class="file-upload__progress">
      <div class="file-upload__progress-bar"></div>
      <span>–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>
  </div>
  
  <div *ngIf="previewUrl" class="file-upload__preview">
    <img [src]="previewUrl" alt="–ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" class="file-upload__preview-image">
    <button *ngIf="!uploadInProgress" 
            class="file-upload__remove"
            (click)="removeImage()">
      √ó 
    </button>
  </div>
  
  <div *ngIf="uploadError" class="file-upload__error">
    {{ uploadError }}
  </div>
</div>

    <button type="submit" [disabled]="eventForm.invalid || uploadInProgress" class="btn btn-primary">
      –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ
    </button>
    <span *ngIf="createError" style="color:red;">{{createError}}</span>
  </form>

  <hr>

  <section class="section" id="events">
    <div class="container">
      <div class="section-header">
        <h2>–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤–∞–º –ø–æ –¥—É—à–µ, –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –≤–æ–ª–æ–Ω—Ç–µ—Ä–∞–º</p>
      </div>
      
      <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ -->
      <div *ngIf="loading" class="loading-spinner">
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π...</p>
      </div>
      
      <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏ -->
      <div *ngIf="error" class="error-message">
        <p>{{ error }}</p>
        <button (click)="loadEvents()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
      </div>
      
      <div class="card-grid">
        <!-- –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ–±—ã—Ç–∏—è -->
        <app-event-card *ngFor="let event of events" [event]="event" (eventDeleted)="onEventDeleted()"></app-event-card>
        
        <!-- –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π -->
        <div *ngIf="!loading && !error && events.length === 0" class="no-events">
          <p>–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</p>
        </div>
      </div>
      
      <div style="text-align: center; margin-top: 40px;">
        <a routerLink="/events" class="btn btn-primary">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a>
      </div>
    </div>
  </section>
</div>